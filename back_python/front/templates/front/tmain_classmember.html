<div class="container page" id="students" data-page-root="students"  ms-controller="students">　
    <nav class="navbar navbar-default  navbar-fixed-top">
      <div class="container-fluid" style="padding-left:10px;padding:right:1px">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand"　 href="#"><img ms-attr="{src:@imgUrl}"  class="img-circle" style="width:30px;height:30px;display:inline"/>{? @cgname ?}</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ms-for="(i,cg) in @cgs"><a ms-attr="{href:'#!/tmain/classmember/'+@cg.id}">{? cg.id ?}:{? cg.name ?}</a></li>
            <li class="active"><a href="#!/tmain/addclass"><i class="fa fa-plus fa-1x active"></i>添加部落</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="childContent"  class="container-fluid childContent" style="height:600px;overflow-y:scroll">
      <ul class="list-group">
        <li  ms-for="(i,item) in @students"   class="list-group-item">
          <!-- <div class="media" style="margin-top:5px">
            <a ms-attr="{href:'#!/main/stage/'+@item.id}"  class="media-left">
                <img class="media-object thumbnail" style="width:115px;height:115px" ms-attr="{src:@item.imgUrl}" alt="...">
            </a>
            <div class="media-body">
                <h4 class="media-heading">
                  {? @item.nickname ?}
                </h4>
                <br/>
                <p>今日打卡状态：<span ms-if="@item.isfeed=='1'" > <i   class="fa fa-check fa-fw active"></i></span><span ms-if="@item.isfeed=='0'" > <i style="color:orange"  class="fa fa-close"></i></span>
                <p>米仓：{? @item.milyAccount ?}粒
                <p>体力值：{? @item.bodyval ?}点
            </div>
          </div> -->
          <div class="panel panel-default">
            <table class="table">
              <tr>
                <td>
                  <a ms-attr="{href:'#!/main/stage/'+@item.id}">
                      <img class="img-circle"  style="width:50px;height:50px" ms-attr="{src:@item.imgUrl}" alt="...">
                      {? @item.nickname ?}
                  </a>
                </td>
                <td class="text-right" >
                     今日打卡状态：<span ms-if="@item.isfeed=='1'" > <i   class="fa fa-check fa-fw active"></i></span><span ms-if="@item.isfeed=='0'" > <i style="color:orange"  class="fa fa-close"></i></span>
                </td>
              </tr>
              <tr><td>米仓:</td><td>{? @item.milyAccount ?}粒</td></tr>
              <tr><td>体力值:</td><td>{? @item.bodyval ?}点</td></tr>
              <tr><td>时光:</td><td class="text-right"><a ms-attr="{href:'#!/main/stage/'+@item.id,class:'active'}"><span class="active"><i class="fa fa-female fa-2x" aria-hidden="true"></i></span>
              </a></td></tr>
            </table>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <script>
  $yml.page=$yml.pageBase.New(null,{
    ctor:function(){
      console.log("addChild loaded..."+this.getVmEleName());
      //基类里在pageReady方法里和可以访问成员$vmPage和$router
      //this.$vmPage
      //this.$router
    },
    vmDef:function(){
      return {
        $id:"students",
        students:[],
        cgs:[],
        cgname:"",
        imgUrl:"",
        backClick:function(){
          //$yml.page.$router.pop();
        },
        cleanUp:function(toCleanVm){
          this.students.clear();
          this.cgs.clear();
        }
      };
    },
    pageReady:function(params){
      var self=this;
      self.$vmMain.wxinit("#",document.location.href)
      $yml.ajax('/api/teacher/classmember',{"cg":params},
      　  function(res){
            self.$vmPage.cleanUp()
            res.content.cgArray.forEach(function(r){
              $yml.page.$vmPage.cgs.push(r)
            });
            res.content.currentCgStudents.forEach(function(r){
              $yml.page.$vmPage.students.push(r)
            });
            $yml.page.$vmPage.cgname=res.content.cgname
            $yml.page.$vmPage.imgUrl=res.content.imgUrl
          }
      );
      $("#childContent").scroll(function(){
         scrollTop =$(this).scrollTop();
         //缓存到本地
         avalon.router.localStorage.setItem("initTop",scrollTop);
      })
      var initTop=avalon.router.localStorage.getItem("initTop")
      if(initTop){
           var top=parseInt(initTop)+200
           $("#childContent").animate({scrollTop:top},500);

      }
    }
  });
  </script>
