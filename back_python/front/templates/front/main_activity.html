<div class="container page" id="activity" data-page-root="activity"  ms-controller="activity">　
    <nav class="navbar navbar-default  navbar-fixed-top">
      <div class="container-fluid" style="padding-left:10px;padding:right:1px">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand"　 href="#!/main/activity/t"><i class="fa fa-diamond fa-lg  active" aria-hidden="true"></i></a>
          <a class="navbar-brand"　 href="#!/main/activity/n"><i class="fa fa-fire fa-lg  active" aria-hidden="true"></i></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">历史活动</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="childContent"  class="container-fluid childContent" style="height:600px;overflow-y:scroll">
        <ul class="list-group">
          <li  ms-for="(i,item) in @activitys" ms-attr="{'data-url':'/main/activity/detail/'+@item.id}"  class="list-group-item">
            <div class="media" style="margin-top:5px">
              <div class="media-left">
                  <a   ms-attr="{href:'#!/main/activity/detail/'+@item.id}">
                      <img class="media-object thumbnail" style="width:112px;height:112px" ms-attr="{src:@item.img}" alt="...">
                  </a>
              </div>
                <div class="media-body">
                  <h4 class="media-heading"><span style="padding-right:5px"><i class="fa fa-gift  active" aria-hidden="true"></i></span>{? item.name ?}</h4>
                  <br/>
                  <p>活动类别：{? @item.cat ?}</p>
                  <p>关键词:{? @item.desc ?}</p>

                </div>
                <div class="media-right media-bottom">
                   <a   ms-attr="{href:'#!/main/activity/detail/'+@item.id}">
                      <button class="btn btn-success btn-1x">报名</button>
                   </a>
                </div>
             </div>
          </li>
        </ul>
        <ul class="nav nav-tabs">
            <li role="presentation" ms-attr="{remark:'f',class:(@isFriend?'active':'')}" class="active" ms-click="@loadContent"><a href="#"><i class="fa fa-sun-o" style="color:orange"></i>我的朋友们</a></li>
            <li role="presentation" ms-attr="{remark:'b',class:(@isFriend?'active':'')}" ><a href="#"><i class="fa fa-thumbs-up fa-1x" style="color:red"></i>体力排行榜</a></li>
            <li role="presentation" ms-attr="{remark:'d',class:(@isFriend?'active':'')}"><a href="#"><i class="fa fa-thumbs-up fa-1x active" ></i>捐米榜</a></li>
        </ul>
        <div id="friends" class="panel panel-default">
          <table class="table">
            <tr><td>朋友们:</td><td>{? (item.role=='4'?'孩子':'家主') ?}</td></tr>
          </table>
        </div>
        <div id="bodyval" class="panel panel-default">
          <table class="table">
            <tr><td>体力:</td><td>ddd</td></tr>
          </table>
        </div>
        <div id="devote" class="panel panel-default">
          <table class="table">
            <tr><td>捐赠:</td><td>ddd</td></tr>
          </table>
        </div>
    </div>
    <!-- <div id="childContent2"  class="container-fluid childContent" style="height:600px;overflow-y:scroll">

    </div> -->
    <div class="modal fade" id="acthelp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-body">
                    <div class="modal-header">
                      <h4 class="modal-title" id="myModalLabel"><i class="fa fa-smile-o" style="color:orange"></i>小小提示</h4>
                    </div>
                    <div class="text-center" style="width:100%;height:120px;margin-top:15px">
                        <div class="text-center">
                          <span>点<button class="btn btn-success btn-1x">报名</button>参加活动，去确定家庭要坚持的习惯！</span>
                        </div>
                        <div style="margin-top:15px;">
                          <button href="#" class="button button-pill  button-action" id="acthelpKnow">我知道了</button>
                        </div>
                    </div>
                </div>
              </div>
        </div>
    </div>
  </div>
  <script>
  $yml.page=$yml.pageBase.New(null,{
    ctor:function(){
      console.log("addChild loaded..."+this.getVmEleName());
      //基类里在pageReady方法里和可以访问成员$vmPage和$router
      //this.$vmPage
      //this.$router
    },
    vmDef:function(){
      return {
        $id:"activity",
        hello:'20天习惯养成',
        activitys:[],
        isFriend:false,
        isBody:true,
        isDevote:false,
        loadContent:function(el){
          //$yml.page.$router.pop();
          var target=el.currentTarget;
          var $t=$(target)
        },
        cleanUp:function(){
          this.activitys.length=0;
          this.activitys=[]
        },
        activeSet:function(e){
          $(".list-group-item.active").removeClass("active")
          $(e.currentTarget).addClass("active")
          //console.log(e)
          console.log("activeSet")
        }
      };
    },
    pageReady:function(params){
      var self=this;
      console.log("pageReady");
      $yml.dlgCenter("acthelp");

      if(!avalon.router.localStorage.getItem("acthelp")){
        $("#acthelp").modal("show");
        $("#acthelpKnow").click(function(){
          $("#acthelp").modal("hide");
          avalon.router.localStorage.setItem("acthelp","1");
        });
      }

      //初始化分页器
      var pager= $yml.pagination.New({
          currentPage:1,
          totalCount:1,
          pageSize:6,
          url:"/api/activity/",
          query:params,
        },{
          ctor:function(){
            this.initData(function(res){
               //如果
               self.$vmPage.cleanUp()
               initUi(res);
               //console.log(res)
            });
          }
        }
      );
      pager.onScroll("childContent",function(res){
           console.log("scroll....")
           initUi(res);
      });
      function initUi(data){
        console.log("init data")
         if(data){
           var c=null;
           data.forEach(function(d){
             self.$vmPage.activitys.push(d)
           });

         }
      }
    }
  });
  </script>
